<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The mpi Module &#8212; OM 20.08.0.0dev documentation</title>
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/my-styles.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinxcontrib-images/LightBox2/lightbox2/css/lightbox.css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script src="_static/sphinxcontrib-images/LightBox2/lightbox2/js/jquery-1.11.0.min.js"></script>
    <script src="_static/sphinxcontrib-images/LightBox2/lightbox2/js/lightbox.min.js"></script>
    <script src="_static/sphinxcontrib-images/LightBox2/lightbox2-customize/jquery-noconflict.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="The processing_layer Package" href="om.processing_layer.html" />
    <link rel="prev" title="The parallelization_layer Package" href="om.parallelization_layer.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="_static/js/jquery-1.12.4.min.js "></script>
<script type="text/javascript" src="_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="_static/bootstrap-3.4.1/js/bootstrap.min.js "></script>
<script type="text/javascript" src="_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          OM</a>
        <span class="navbar-text navbar-version pull-left"><b>20.08.0.0dev</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="documentation_what_is_an_om_monitor.html">What is OM?</a></li>
                <li><a href="documentation_running_om.html">Running OM</a></li>
                <li><a href="documentation_advanced_documentation.html">Advanced Documentation</a></li>
                <li><a href="https://github.com/omdevteam/om">Source Code</a></li>
            
            
              
              
            
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <p>[<a class="reference internal" href="om.html"><span class="doc">Back to top of code documentation</span></a>]</p>
<div class="section" id="module-om.parallelization_layer.mpi">
<span id="the-mpi-module"></span><h1>The mpi Module<a class="headerlink" href="#module-om.parallelization_layer.mpi" title="Permalink to this headline">¶</a></h1>
<p>MPI-based parallelization engine for OM.</p>
<p>This module contains an MPI-based parallelization engine for OM, based on a
master/worker architecture.</p>
<dl class="py class">
<dt id="om.parallelization_layer.mpi.ParallelizationEngine">
<em class="property">class </em><code class="sig-name descname">ParallelizationEngine</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">process_func</span></em>, <em class="sig-param"><span class="n">collect_func</span></em>, <em class="sig-param"><span class="n">source</span></em>, <em class="sig-param"><span class="n">monitor_params</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/om/parallelization_layer/mpi.html#ParallelizationEngine"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#om.parallelization_layer.mpi.ParallelizationEngine" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>An MPI-based master-worker parallelization engine for OM.</p>
<p>This engine starts several processing worker nodes and an aggregating worker
node. The nodes  communicate with each other using the MPI protocol. When the
engine starts, two functions, ‘process_func’ and ‘collect_func’, are attached
to it. The engine operates according to the following rules:</p>
<ul class="simple">
<li><p>On each worker node, the engine retrieves one data event from a source.
It then executes the ‘process_func’ function on every frame in the event.
Each time, it makes sure that the object returned by the function is
transferred to the master node.</p></li>
<li><p>On the master node, the engine executes the ‘collect_func’ function every
time an object is transferred from a worker node. The engine passes the
received object to the function.</p></li>
<li><p>When all events from the source have been processed, the engine performs
some final clean-up tasks and shuts down.</p></li>
</ul>
<p>NOTE: This class is designed to be subclassed to create an OM monitor.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>process_func</strong> (<em>Callable</em><em>[</em><em>[</em><em>Dict</em><em>[</em><em>str</em><em>, </em><em>Any</em><em>]</em><em>]</em><em>, </em><em>Tuple</em><em>[</em><em>Dict</em><em>[</em><em>str</em><em>, </em><em>Any</em><em>]</em><em>, </em><em>int</em><em>]</em><em>]</em>) – the
function that will be called on each worker node for every frame in a
data event. The input to the function is a dictionary storing the
extracted data for the frame being processed. The tuple returned by
the function, storing the processed data and information about the
worker processing the data, will be transferred to the master node.</p></li>
<li><p><strong>collect_func</strong> (<em>Callable</em><em>[</em><em>[</em><em>Dict</em><em>[</em><em>str</em><em>, </em><em>Any</em><em>]</em><em>, </em><em>None</em><em>]</em>) – the function that will run
on the master node every time a ‘ProcessedData’ named tuple is
transferred from a worker node. The input to the function is the
tuple returned by the process_func function in the previous argument.</p></li>
<li><p><strong>source</strong> (<em>str</em>) – a string describing a source of event data. The exact format
of the string depends on the specific Data Recovery Layer currently
being used. See the documentation of the relevant
‘initialize_event_source’ function).</p></li>
<li><p><strong>monitor_params</strong> (<a class="reference internal" href="om.utils.parameters.html#om.utils.parameters.MonitorParams" title="om.utils.parameters.MonitorParams"><code class="xref py py-class docutils literal notranslate"><span class="pre">MonitorParams</span></code></a>) – an object
storing the OM monitor parameters from the configuration file.</p></li>
</ul>
</dd>
</dl>
<dl class="py attribute">
<dt id="om.parallelization_layer.mpi.ParallelizationEngine.role">
<code class="sig-name descname">role</code><a class="headerlink" href="#om.parallelization_layer.mpi.ParallelizationEngine.role" title="Permalink to this definition">¶</a></dt>
<dd><p>the role of the current node (‘worker’ or ‘master’).</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt id="om.parallelization_layer.mpi.ParallelizationEngine.rank">
<code class="sig-name descname">rank</code><a class="headerlink" href="#om.parallelization_layer.mpi.ParallelizationEngine.rank" title="Permalink to this definition">¶</a></dt>
<dd><p>the rank (in MPI terms) of the current node.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>int</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="om.parallelization_layer.mpi.ParallelizationEngine.start">
<code class="sig-name descname">start</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/om/parallelization_layer/mpi.html#ParallelizationEngine.start"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#om.parallelization_layer.mpi.ParallelizationEngine.start" title="Permalink to this definition">¶</a></dt>
<dd><p>Starts the parallelization engine.</p>
<ul class="simple">
<li><p>When this function is called on a worker node, the node starts retrieving
data events and processing them.</p></li>
<li><p>When this function is called on the master node, the node starts receiving
data from the worker nodes and aggregating it.</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="om.parallelization_layer.mpi.ParallelizationEngine.shutdown">
<code class="sig-name descname">shutdown</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">msg</span><span class="o">=</span><span class="default_value">'Reason not provided.'</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/om/parallelization_layer/mpi.html#ParallelizationEngine.shutdown"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#om.parallelization_layer.mpi.ParallelizationEngine.shutdown" title="Permalink to this definition">¶</a></dt>
<dd><p>Shuts down the parallelization engine.</p>
<ul class="simple">
<li><p>When this function is called on a worker node, the worker communicates to the
master node that it is shutting down, then shuts down.</p></li>
<li><p>When this function is called on the master node, the master tells each worker
to shut down, waits for all the workers to confirm that they done that, then
shuts down.</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>msg</strong> (<em>Union</em><em>[</em><em>str</em><em>, </em><em>None</em><em>]</em>) – reason for shutting down the parallelization
engine. Defaults to “Reason not provided”.</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><code class="docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="om.parallelization_layer.mpi.ParallelizationEngine.end_processing">
<code class="sig-name descname">end_processing</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/om/parallelization_layer/mpi.html#ParallelizationEngine.end_processing"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#om.parallelization_layer.mpi.ParallelizationEngine.end_processing" title="Permalink to this definition">¶</a></dt>
<dd><p>Executes end-of-processing actions.</p>
<p>This function is called by the parallelization engine on the master node at the
end of the processing, immediately before stopping. By default, it prints a
message to the console and exits. It can be overridden in a derived class to
implement custom end-of-processing actions.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><code class="docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 
    2020 SLAC National Accelerator Laboratory -
    Based on OnDA: Copyright 2014-2019 Deutsches Elektronen-Synchrotron DESY,
    a research centre of the Helmholtz Association.
.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.1.2.<br/>
    </p>
  </div>
</footer>
  </body>
</html>